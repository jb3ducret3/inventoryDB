version: '3'

services:
  inventaireDB:
    restart: always
    image: homeassistant/home-assistant
    volumes:
    - /srv/docker/home-assistant:/config
    labels:
    - "traefik.enable=true"
    - "traefik.http.routers.home.rule=Host(`inventaireDB.local`)"
    - "traefik.http.routers.home.entrypoints=http"
    - "traefik.http.routers.home.tls=true"
    - "traefik.http.routers.home.tls.certresolver=user"
    - "traefik.http.inventaireDBport=8888"
       # Activer Traefik pour ce service
    - "traefik.http.routers.inventaireDB.entrypoints=websecure"
      # Spécifier le port sur lequel votre application écoute
    - "traefik.http.services.inventaireDB.loadbalancer.server.port=8888"

  reverse-proxy:
    restart: always
    image: traefik:v2.0
    ports:
    - "443:443"
    - "80:80"
    volumes:
    - /srv/traefik.toml:/etc/traefik/traefik.toml
    - /srv/services.toml:/etc/traefik/services.toml
    - /var/run/docker.sock:/var/run/docker.sock
    labels:
    - "traefik.http.routers.api.rule=Host(`traefik.inventaireDB.local`)"
    - "traefik.http.routers.api.service=api@internal"
    - "traefik.http.routers.api.entrypoints=http"
    - "traefik.http.routers.api.middlewares=auth"
	#docker run --rm --name apache httpd:alpine htpasswd -nb admin corsic
    - "traefik.http.middlewares.auth.basicauth.users=$pwssd"
